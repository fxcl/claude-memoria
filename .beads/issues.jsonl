{"id":"claude-memoria-igs","title":"Compare ACE framework documentation with claude-memoria implementation","description":"## Problem Statement\nThe `claude-memoria` project claims to be a \"simplified implementation of Agentic Context Engineering (ACE)\" for Claude Code. This research task aims to determine whether claude-memoria actually implements the ACE framework and identify how to add missing ACE features.\n\n## Research Completed\nResearch artifact at `.beads/artifacts/claude-memoria-9jj/research.md` contains:\n- Executive summary: claude-memoria implements ~44% of ACE\n- Architecture deep analysis comparing hook-based vs agent-based\n- Feature matrix (5 implemented, 4 partial, 7 missing)\n- Code-level analysis with file:line references\n- Missing feature specifications with priorities\n- Claude platform integration roadmap\n- Decision framework (use as-is / extend / rebuild)\n\n## Implementation Plan\nThis epic adds three high-ROI ACE features (Option 1: Quick Wins):\n1. Extended Thinking (2h) - Deep reflection with thinking budget\n2. Prompt Caching (4h) - 75% cost reduction via cache_control\n3. Multi-round Reflection (16h) - Iterative analysis with convergence\n\nExpected ROI: 75% cost savings, 17% accuracy improvement (based on ACE benchmarks).\n\n## References\n- Research: `.beads/artifacts/claude-memoria-9jj/research.md`\n- Plan: `.beads/artifacts/claude-memoria-9jj/plan.md`\n- ACE Documentation: `docs/ace.md`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T19:44:37.535542+08:00","updated_at":"2025-12-27T20:19:45.640446+08:00","closed_at":"2025-12-27T20:19:45.640446+08:00","close_reason":"All phases complete - ACE Quick Wins implemented (Extended Thinking, Prompt Caching, Multi-round Reflection)"}
{"id":"claude-memoria-igs.1","title":"Add Extended Thinking to claude-memoria","description":"## Context\nThis phase adds Claude's Extended Thinking feature to enable deeper causal analysis during key point extraction. This is Phase 1 of the ACE Quick Wins implementation, expected to improve reflection quality by enabling the model to perform deeper reasoning before outputting results.\n\n## Key Changes\n- `src/hooks/common.ts:272-374` - Add `thinking` parameter to `extractKeypoints()` API call\n- New environment variable: `AGENTIC_CONTEXT_THINKING_BUDGET` (default: 16000)\n- Conditional feature: disabled when budget = 0 (backward compatible)\n\n## Implementation Details\n1. Read `AGENTIC_CONTEXT_THINKING_BUDGET` env var (parse as int, default 16000)\n2. Build API params object dynamically\n3. Add `thinking: {type: 'enabled', budget_tokens: \u003cvalue\u003e}` when budget \u003e 0\n4. Preserve existing behavior when budget = 0\n\n## Patterns to Follow\n- See `common.ts:289-292` for existing env var pattern (model configuration)\n- Use same style: `process.env['VAR_NAME'] || 'default_value'`\n\n## Success Criteria\n- [ ] Build passes: `npm run build`\n- [ ] TypeScript compiles without errors\n- [ ] Setting `AGENTIC_CONTEXT_THINKING_BUDGET=0` preserves existing behavior\n- [ ] Setting `AGENTIC_CONTEXT_THINKING_BUDGET=16000` enables extended thinking\n\n## References\n- Full plan: `.beads/artifacts/claude-memoria-9jj/plan.md`\n- Research: `.beads/artifacts/claude-memoria-9jj/research.md`\n- Anthropic docs: https://platform.claude.com/docs/en/build-with-claude/extended-thinking","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T19:45:25.11703+08:00","updated_at":"2025-12-27T20:19:26.914001+08:00","closed_at":"2025-12-27T20:19:26.914001+08:00","close_reason":"Phase 1 complete - Extended Thinking implemented, Coach Approved","dependencies":[{"issue_id":"claude-memoria-igs.1","depends_on_id":"claude-memoria-igs","type":"parent-child","created_at":"2025-12-27T19:45:25.119553+08:00","created_by":"daemon"}]}
{"id":"claude-memoria-igs.2","title":"Add Prompt Caching to claude-memoria","description":"## Context\nThis phase adds prompt caching for the playbook prefix to reduce API costs by 75%. The playbook (which changes infrequently) will be cached in the system message, while trajectories (which change every session) remain in the user message.\n\n## Key Changes\n- `src/hooks/common.ts:305-327` - Restructure API call to use system message with cache_control\n- `src/prompts/reflection.txt` - Remove {playbook} placeholder (moved to system message)\n- New environment variable: `AGENTIC_CONTEXT_USE_CACHE` (default: true)\n\n## Implementation Details\n1. Read `AGENTIC_CONTEXT_USE_CACHE` env var (default: true, check for \"false\" string)\n2. When caching enabled:\n   - Build system message with playbook text + `cache_control: {type: 'ephemeral'}`\n   - Keep only {trajectories} in user prompt (template update)\n3. When caching disabled:\n   - Preserve existing behavior (everything in user message)\n4. Update `src/prompts/reflection.txt` to remove {playbook} placeholder\n\n## Template Changes\n**Before:**\n```\n# Reasoning Trajectories\n{trajectories}\n\n# Current Playbook\n{playbook}\n```\n\n**After:**\n```\n# Reasoning Trajectories\n{trajectories}\n```\n(Playbook moved to system message when caching enabled)\n\n## Patterns to Follow\n- See `common.ts:165-174` for existing template loading with `formatPlaybook()`\n- Use `split()` and `join()` pattern for template replacement (line 314-315)\n\n## Success Criteria\n- [ ] Build passes: `npm run build`\n- [ ] TypeScript compiles without errors\n- [ ] Default behavior enables caching\n- [ ] Setting `AGENTIC_CONTEXT_USE_CACHE=false` disables caching\n- [ ] Diagnostic output shows system message structure when enabled\n\n## References\n- Full plan: `.beads/artifacts/claude-memoria-9jj/plan.md`\n- Research: `.beads/artifacts/claude-memoria-9jj/research.md`\n- Anthropic docs: https://platform.claude.com/docs/en/build-with-claude/prompt-caching","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T19:45:26.593504+08:00","updated_at":"2025-12-27T20:19:27.849116+08:00","closed_at":"2025-12-27T20:19:27.849116+08:00","close_reason":"Phase 2 complete - Prompt Caching implemented, Coach Approved","dependencies":[{"issue_id":"claude-memoria-igs.2","depends_on_id":"claude-memoria-igs","type":"parent-child","created_at":"2025-12-27T19:45:26.596271+08:00","created_by":"daemon"}]}
{"id":"claude-memoria-igs.3","title":"Add Multi-round Reflection to claude-memoria","description":"## Context\nThis phase implements iterative reflection with convergence checking, similar to ACE's multi-round analysis (up to 5 rounds). Each round builds on the previous, stopping when convergence is detected or max rounds reached. Expected to improve accuracy by 17.1% based on ACE benchmarks.\n\n## Key Changes\n- `src/hooks/common.ts:323-374` - Replace single API call with loop (up to MAX_ROUNDS)\n- `src/prompts/reflection.txt` - Add multi-round instructions and convergence fields\n- Extract helper functions: `buildApiParams()`, `parseReflectionResponse()`\n- New environment variable: `AGENTIC_CONTEXT_MAX_ROUNDS` (default: 1 for backward compat)\n\n## Implementation Details\n1. Read `AGENTIC_CONTEXT_MAX_ROUNDS` env var (parse as int, default 1)\n2. Implement loop (round 0 to maxRounds):\n   - Build round-specific prompt (include previous insights if round \u003e 0)\n   - Call API with existing params (thinking, cache from Phases 1-2)\n   - Parse response for convergence indicators\n   - Accumulate insights across rounds\n   - Stop early if converged (found_root_cause, no_new_insights, or insights_depth === 'sufficient')\n3. Extract `buildApiParams()` to reduce duplication (combine Phase 1 + 2 logic)\n4. Extract `parseReflectionResponse()` for cleaner response handling\n5. Update prompt template with multi-round instructions\n\n## Convergence Indicators (add to prompt output format)\n```json\n{\n  \"insights\": [\"key insight 1\", \"key insight 2\"],\n  \"found_root_cause\": false,\n  \"no_new_insights\": false,\n  \"insights_depth\": \"initial\" | \"deeper\" | \"sufficient\"\n}\n```\n\n## Patterns to Follow\n- Use existing `saveDiagnostic()` for logging (line 24-40)\n- Follow `split()`/`join()` pattern for template replacement (line 314-315)\n- Preserve `ExtractionResult` return type (line 176-179)\n\n## Success Criteria\n- [ ] Build passes: `npm run build`\n- [ ] TypeScript compiles without errors\n- [ ] Setting `AGENTIC_CONTEXT_MAX_ROUNDS=1` preserves existing behavior\n- [ ] Setting `AGENTIC_CONTEXT_MAX_ROUNDS=3` enables multi-round\n- [ ] Convergence detection works (early termination)\n- [ ] Diagnostic output shows round number and convergence status\n\n## References\n- Full plan: `.beads/artifacts/claude-memoria-9jj/plan.md`\n- Research: `.beads/artifacts/claude-memoria-9jj/research.md`\n- ACE Chapter 5: Multi-round reflection achieves 17.1% accuracy improvement","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T19:45:29.083808+08:00","updated_at":"2025-12-27T20:19:28.600458+08:00","closed_at":"2025-12-27T20:19:28.600458+08:00","close_reason":"Phase 3 complete - Multi-round Reflection implemented, Coach Approved","dependencies":[{"issue_id":"claude-memoria-igs.3","depends_on_id":"claude-memoria-igs","type":"parent-child","created_at":"2025-12-27T19:45:29.086546+08:00","created_by":"daemon"}]}
